{% set feed_url = blog.url == '/' or blog.url == base_url_relative ? (base_url_relative ~ '/' ~ blog.slug) : blog.url %}
{% set new_base_url = blog.url == '/' ? '' : blog.url %}

<div class="sidebar-content-wrapper" role="region" aria-label="Sidebar content">

    {% if config.plugins.simplesearch.enabled %}
    <section class="sidebar-content" aria-labelledby="search-heading">
        <h3 id="search-heading" class="visually-hidden">{{ 'THEME_QUARK_A11Y.SIDEBAR.SEARCH.HEADLINE'|t|default('Search') }}</h3>
        {{ include('partials/simplesearch_searchbox.html.twig') }}
    </section>
    {% endif %}

    {% if config.plugins.relatedpages.enabled and related_pages|length > 0 %}
    <section class="sidebar-content" aria-labelledby="related-posts-heading">
        <h4 id="related-posts-heading">{{ 'THEME_QUARK_A11Y.SIDEBAR.RELATED_POSTS.HEADLINE'|t }}</h4>
        {{ include('partials/relatedpages.html.twig') }}
    </section>
    {% endif %}

    {% if config.plugins.random.enabled %}
    <section class="sidebar-content" aria-labelledby="random-article-heading">
        <h4 id="random-article-heading">{{ 'THEME_QUARK_A11Y.SIDEBAR.RANDOM_ARTICLE.HEADLINE'|t }}</h4>
        <a class="button" href="{{ base_url }}/random" aria-label="{{ 'THEME_QUARK_A11Y.SIDEBAR.RANDOM_ARTICLE.FEELING_LUCKY'|t }}">
            <i class="fa fa-retweet" aria-hidden="true"></i> {{ 'THEME_QUARK_A11Y.SIDEBAR.RANDOM_ARTICLE.FEELING_LUCKY'|t }}
        </a>
    </section>
    {% endif %}

    {% if page.find('/modules/sidebar') %}
    <section class="sidebar-content" aria-labelledby="custom-modules-heading">
        <h4 id="custom-modules-heading" class="visually-hidden">Custom Modules</h4>
        {{ page.find('/modules/sidebar').content|raw }}
    </section>
    {% endif %}

    {% if config.plugins.taxonomylist.enabled %}
    <section class="sidebar-content" aria-labelledby="popular-tags-heading">
        <h4 id="popular-tags-heading">{{ 'THEME_QUARK_A11Y.SIDEBAR.POPULAR_TAGS.HEADLINE'|t }}</h4>
        {{ include('partials/taxonomylist.html.twig', {base_url: new_base_url, taxonomy: 'tag', children_only: true}) }}
    </section>
    {% endif %}

    {% if config.plugins.archives.enabled %}
    <section class="sidebar-content" aria-labelledby="archives-heading">
        <h4 id="archives-heading">{{ 'THEME_QUARK_A11Y.SIDEBAR.ARCHIVES.HEADLINE'|t }}</h4>
        {{ include('partials/archives.html.twig', {base_url: new_base_url}) }}
    </section>
    {% endif %}

    {% if config.plugins.feed.enabled %}
    <section class="sidebar-content syndicate" aria-labelledby="syndicate-heading">
        <h4 id="syndicate-heading">{{ 'THEME_QUARK_A11Y.SIDEBAR.SYNDICATE.HEADLINE'|t }}</h4>
        <div class="feed-buttons" role="group" aria-label="Feed subscription options">
            <a class="btn" href="{{ feed_url }}.atom" aria-label="Subscribe to Atom feed">
                <i class="fa fa-rss-square" aria-hidden="true"></i> Atom 1.0
            </a>
            <a class="btn" href="{{ feed_url }}.rss" aria-label="Subscribe to RSS feed">
                <i class="fa fa-rss-square" aria-hidden="true"></i> RSS
            </a>
            {% if config.plugins.feed.enable_json_feed %}
            <a class="btn" href="{{ feed_url }}.json" aria-label="Subscribe to JSON feed">
                <i class="fa fa-rss-square" aria-hidden="true"></i> JSON
            </a>
            {% endif %}
        </div>
    </section>
    {% endif %}

</div>
